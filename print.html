<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Mogglo</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">User documentation</li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="guide.html"><strong aria-hidden="true">2.</strong> Guide</a></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">3.</strong> Contributing</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference</li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">4.</strong> Lua API reference</a></li><li class="chapter-item expanded affix "><li class="part-title">Developer documentation</li><li class="chapter-item expanded "><a href="dev.html"><strong aria-hidden="true">5.</strong> Development</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Mogglo</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/langston-barrett/mogglo/tree/main/doc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>Mogglo is a multi-language AST-based code search and rewriting tool. Mogglo
supports embedding <a href="https://www.lua.org/">Lua</a> code in search patterns and replacements.</p>
<p>Mogglo focuses on the following goals:</p>
<ul>
<li><em>Minimal setup</em>: Mogglo will work right away on any codebase in a
supported language.</li>
<li><em>Many languages</em>: 12 and counting!</li>
<li><em>High-quality grammars</em>: Mogglo is based on <a href="https://tree-sitter.github.io/tree-sitter/">tree-sitter</a>
grammars.</li>
<li><em>Lua</em>: Mogglo exposes a rich API to embedded Lua snippets.</li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>The following examples give a taste of Mogglo. Here's how to find pointless
assignments of an expression to itself:</p>
<pre><code class="language-sh">mogglo-rust --detail 'let $x = $x;' ./**/*.rs
</code></pre>
<p>The <code>--detail</code> flag helps you understand why something matched, it produces
fancy output like:</p>
<pre><code>   ╭─[./test/nonlinear.rs:4:1]
   │
 4 │ ╭─▶ let a =
   │ │       ┬
   │ │       ╰── $x
 5 │ ├─▶     a;
   │ │       ┬
   │ │       ╰──── $x
   │ │
   │ ╰──────────── let $x = $x;
   │
   │ Note: Multiple occurrences of $x were structurally equal
───╯
</code></pre>
<p>Lua code is wrapped in braces. Lua can recursively match patterns with <code>rec</code>.
Here's a pattern to detect out-of-bounds array accesses:</p>
<pre><code class="language-sh">mogglo-rust 'while $i &lt;= $buf.len() { ${{ rec(&quot;$buf.get($i)&quot;) }} }' ./**/*.rs
</code></pre>
<p>Here's how to <a href="https://en.wikipedia.org/wiki/Loop_unrolling">unroll</a> a simple loop:</p>
<pre><code class="language-sh">mogglo-rust \
  'for $i in 0..$h { $b; }' \
  --where 'h_num = tonumber(h); return h_num ~= nil and h_num % 4 == 0' \
  --replace 'for $i in 0..${{ string.format(&quot;%.0f&quot;, h / 4) }} { $b; $b; $b; $b; }' \
  ./*/**.rs
</code></pre>
<p>This transformation demonstrates the power of using Lua: it can't be done with
regular expression substitutions and would be very difficult with other codemod
tools.</p>
<p>Lua snippets can match and negate patterns, or even compose new patterns
dynamically! See <a href="./guide.html">the guide</a> for more detailed explanations,
examples, and features.</p>
<h2 id="supported-languages"><a class="header" href="#supported-languages">Supported languages</a></h2>
<p>Mogglo currently ships pre-built executables for the following languages:</p>
<ul>
<li><a href="./crates/mogglo-c">C</a></li>
<li><a href="./crates/mogglo-css">CSS</a></li>
<li><a href="./crates/mogglo-java">Java</a></li>
<li><a href="./crates/mogglo-javascript">JavaScript</a></li>
<li><a href="./crates/mogglo-rust">Rust</a></li>
<li><a href="./crates/mogglo-typescript">TypeScript</a></li>
<li><a href="./crates/mogglo-swift">Swift</a></li>
</ul>
<p>Additionally, the following can be built from source or via Cargo/crates.io:</p>
<ul>
<li><a href="./crates/mogglo-cpp">C++</a></li>
<li><a href="./crates/mogglo-haskell">Haskell</a></li>
<li><a href="./crates/mogglo-html">HTML</a></li>
<li><a href="./crates/mogglo-python">Python</a></li>
<li><a href="./crates/mogglo-ruby">Ruby</a></li>
</ul>
<p>Languages are very easy to add, so file an issue or a PR if you want a new one!</p>
<h2 id="comparison-to-related-tools"><a class="header" href="#comparison-to-related-tools">Comparison to related tools</a></h2>
<p>Mogglo is not as polished as any of the tools mentioned in this section.</p>
<p>Mogglo is most similar to other multi-language code search and codemod tools.</p>
<ul>
<li>Mogglo is similar to <a href="https://ast-grep.github.io/">ast-grep</a>, but supports more languages and
allows embedding Lua in patterns.</li>
<li>Mogglo is similar to <a href="https://comby.dev/">Comby</a>. Comby uses lower-fidelity parsers, but
is much more battle-tested and better documented. Mogglo also embeds Lua in
patterns.</li>
<li>Mogglo has less semantic understanding of code (e.g., name resolution) than
<a href="https://semgrep.dev/">Semgrep</a> or <a href="https://codeql.github.com/">CodeQL</a>, but is much easier to set up.</li>
</ul>
<p>There are many excellent language-specific code search and codemod tools; these
tend to be more polished but less general than Mogglo.</p>
<ul>
<li><a href="https://github.com/facebookincubator/retrie">retrie</a></li>
<li><a href="https://github.com/weggli-rs/weggli">weggli</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h2 id="pre-compiled-binaries"><a class="header" href="#pre-compiled-binaries">Pre-compiled binaries</a></h2>
<p>Statically-linked Linux binaries are available on the <a href="https://github.com/langston-barrett/mogglo/releases">releases page</a>.</p>
<h3 id="fetching-binaries-with-curl"><a class="header" href="#fetching-binaries-with-curl">Fetching binaries with cURL</a></h3>
<p>You can download binaries with <code>curl</code> like so (replace <code>X.Y.Z</code> with a real
version number and <code>LANG</code> with a supported language):</p>
<pre><code class="language-sh">curl -sSL https://github.com/langston-barrett/mogglo/releases/download/vX.Y.Z/mogglo-LANG -o mogglo-LANG
</code></pre>
<h2 id="build-from-source"><a class="header" href="#build-from-source">Build from source</a></h2>
<p>To install from source, you'll need to install Rust and <a href="https://doc.rust-lang.org/cargo/">Cargo</a>. Follow
the instructions on the <a href="https://www.rust-lang.org/tools/install">Rust installation page</a>.</p>
<h3 id="from-a-release-on-cratesio"><a class="header" href="#from-a-release-on-cratesio">From a release on crates.io</a></h3>
<p>You can build a released version from <a href="https://crates.io/">crates.io</a>. To install the latest
release of Mogglo for the language <code>&lt;LANG&gt;</code>, run:</p>
<pre><code class="language-sh">cargo install mogglo-&lt;LANG&gt;
</code></pre>
<p>This will automatically download the source from <a href="https://crates.io/">crates.io</a>, build it, and
install it in Cargo's global binary directory (<code>~/.cargo/bin/</code> by default).</p>
<h3 id="from-the-latest-version-on-github"><a class="header" href="#from-the-latest-version-on-github">From the latest version on Github</a></h3>
<p>To use the very latest unreleased version, run:</p>
<pre><code class="language-sh">cargo install --git https://github.com/langston-barrett/mogglo.git mogglo-LANG
</code></pre>
<h3 id="from-a-local-checkout"><a class="header" href="#from-a-local-checkout">From a local checkout</a></h3>
<p>See the <a href="dev.html">developer's guide</a>.</p>
<h3 id="uninstalling"><a class="header" href="#uninstalling">Uninstalling</a></h3>
<p>To uninstall, run <code>cargo uninstall mogglo-&lt;LANG&gt;</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="guide"><a class="header" href="#guide">Guide</a></h1>
<p>Mogglo searches for <em>patterns</em> in code. Mogglo patterns consist of code
augmented with <em>metavariables</em> and embedded Lua code.</p>
<h2 id="metavariables"><a class="header" href="#metavariables">Metavariables</a></h2>
<p>Metavariables match nodes in the syntax tree. For example, the pattern
<code>let $x = ();</code> finds pointless assignments of the unit value <code>()</code>; the
metavariable <code>$x</code> matches any expression.</p>
<p>Multiple uses of the same metavariable imply equality. For example the pattern
<code>let $x = $x;</code> finds pointless assignments of an identifier to itself.</p>
<p>The special metavariable <code>$_</code> matches any syntax node, and multiple uses don't
imply equality. For example, <code>$_ == $_</code> finds an equality comparison between
any two expressions.</p>
<p>The special metavariable <code>$..</code> (read &quot;ellipsis&quot;) can match any number of
sibling nodes in the AST. For example, here's how to find the main function:</p>
<pre><code>fn main() $.. { $.. }
</code></pre>
<h2 id="matching-nodes-with-multiple-children"><a class="header" href="#matching-nodes-with-multiple-children">Matching nodes with multiple children</a></h2>
<p>Consider that there are several possible readings of the following pattern:</p>
<pre><code>{ $f($x); $y + $z; }
</code></pre>
<p>It might only match blocks with exactly two statements, a call and an addition.
It might match a block that contains any number of statements, as long as there
is call followed <em>immediately</em> by an addition. In fact, Mogglo interprets this
pattern as matching any block that contains any number of statements, including
a function call that is followed <em>at some point</em> by an addition.</p>
<h2 id="lua"><a class="header" href="#lua">Lua</a></h2>
<p>Lua code is written between curly braces: <code>${{lua code goes here}}</code>.
See <a href="./api.html">the API reference</a> for details.</p>
<h2 id="speed"><a class="header" href="#speed">Speed</a></h2>
<p>Regular expressions are slow. Don't use them if string matching will do.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>By default, matches are non-recursive:</p>
<pre><code class="language-sh">echo 'let a = { let b = c; c };' | mogglo-rust 'let $x = $y;' -
</code></pre>
<pre><code>   ╭─[-:1:1]
   │
 1 │ let a = { let b = c; c };
   │ ────────────┬────────────
   │             ╰────────────── Match
───╯
</code></pre>
<p>The <code>--recursive</code> flag requests recursive matches, it will additionally print:</p>
<pre><code>   ╭─[-:1:11]
   │
 1 │ let a = { let b = c; c };
   │           ─────┬────
   │                ╰────── Match
───╯
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<p>Thank you for your interest in Mogglo! We welcome and appreciate all kinds of
contributions. Please feel free to file and issue or open a pull request.</p>
<p>You may want to take a look at:</p>
<ul>
<li>The <a href="dev.html">developer guide</a></li>
<li>The <a href="https://github.com/langston-barrett/mogglo/issues?q=is%3Aopen+is%3Aissue+label%3A%22good+first+issue%22">issues labeled &quot;good first issue&quot;</a></li>
<li>The <a href="https://github.com/langston-barrett/mogglo/issues?q=is%3Aopen+is%3Aissue+label%3A%22help+wanted%22">issues labeled &quot;help wanted&quot;</a></li>
</ul>
<p>If you have questions, please ask them on the <a href="https://github.com/langston-barrett/mogglo/discussions">discussions page</a>!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lua-api-reference"><a class="header" href="#lua-api-reference">Lua API reference</a></h1>
<h2 id="contexts"><a class="header" href="#contexts">Contexts</a></h2>
<p>Lua code is evaluated in three different contexts:</p>
<ul>
<li>Patterns: Lua code embedded in <code>${{}}</code> when <em>matching</em> code</li>
<li>Replacments: Lua code embedded in <code>${{}}</code> when <em>replacing</em> code</li>
<li>Where clauses: Lua code passed to <code>--where</code>.</li>
</ul>
<p>The value produced by code evaluated in patterns and where clauses is treated
as a boolean. If code in a pattern evaluates to <code>false</code> or <code>nil</code>, the node
is not matched; if the code evaluates to anything else, it is. For example,
<code>${{true}}</code> is equivalent to <code>$_</code>. Code evaluated in a replacement is treated
as a string.</p>
<p>The APIs available to code in patterns differ from those available to
replacements and where clauses. For example, code in patterns can write to
metavariables; code in replacements and where clauses can only read them.
In the rest of this guide, (P) denotes an API available only to patterns,
(A) denotes an API available in all contexts.</p>
<h2 id="globals"><a class="header" href="#globals">Globals</a></h2>
<p>(P) Lua code has access to a global variable <code>t</code> that holds the text of the
syntax node in question. For example, this pattern finds let-bound variables
that contain the letter <code>x</code>:</p>
<pre><code>let ${{string.find(t, &quot;x&quot;)}} = $_;
</code></pre>
<p>(A) All other metavariables are bound to globals; the pattern author is
responsible for not clobbering other important globals.</p>
<h2 id="conventions"><a class="header" href="#conventions">Conventions</a></h2>
<p>In the remainder of this document:</p>
<ul>
<li><code>Option&lt;T&gt;</code> means <code>T</code> or <code>nil</code>.</li>
<li>If the return type is omitted, it is <code>nil</code>.</li>
</ul>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<ul>
<li>
<p><code>bind(String)</code>, (P): Binds a metavariable to the current node</p>
<ul>
<li>1st argument: Metavariable name (without the <code>$</code>)</li>
<li>Example: <code>${{bind(&quot;x&quot;)}}</code> is equivalent to <code>$x</code> if <code>$x</code> is not yet bound</li>
<li>Note: This function can overwrite existing bindings; use with care</li>
</ul>
</li>
<li>
<p><code>match(String) -&gt; bool</code>, (P): Matches the current node against a pattern</p>
<ul>
<li>1st argument: A pattern</li>
<li>Returns: Whether or not the current node matches the pattern</li>
<li>Example: Patterns can be negated with <code>match</code>: <code>${{not match(&quot;&lt;pattern&gt;&quot;)}}</code>,
e.g., <code>${{not match(&quot;${{false}}&quot;)}}</code> is equivalent to <code>${{true}}</code>.</li>
<li>Note: Metavariables in the argument pattern are inherited from the overall
pattern; variables bound inside the argument pattern are not bound outside
of it.</li>
</ul>
</li>
<li>
<p><code>meta(String) -&gt; Option&lt;String&gt;</code>, (A): Returns the binding for a metavariable</p>
<ul>
<li>1st argument: Metavariable name (without the <code>$</code>)</li>
<li>Returns: Value of the metavariable, or <code>nil</code> if there is none</li>
<li>Example: <code>${{meta(&quot;x&quot;) == t}}</code> is roughly equivalent to <code>$x</code> if <code>$x</code> is
already bound (though not exactly: it matches <em>textually</em> instead of
<em>structurally</em>)</li>
</ul>
</li>
<li>
<p><code>rec(String) -&gt; bool</code>, (P): Recursively matches all descendants of the current
node against a pattern</p>
<ul>
<li>1st argument: A pattern</li>
<li>Returns: Whether or not some descendant of the current node matches the
pattern</li>
<li>Example: <code>let x = ${{rec(&quot;$x&quot;)}} + $y;</code> matches <code>let a = (b + a) + c;</code></li>
<li>Note: Metavariables in the argument pattern are inherited from the overall
pattern; variables bound inside the argument pattern are not bound outside
of it.</li>
</ul>
</li>
<li>
<p><code>rx(String, String) -&gt; bool</code>, (A): Returns whether its first argument is a
regular expression that matches its second.</p>
<ul>
<li>1st argument: Regular expression</li>
<li>2nd argument: String to be matched</li>
<li>Returns: Whether the regex matched the string</li>
</ul>
</li>
</ul>
<h2 id="nodes"><a class="header" href="#nodes">Nodes</a></h2>
<p>In addition to the &quot;textual&quot; API given by the <code>t</code> variable, Lua code has
access to a &quot;structured&quot; API for AST nodes. The type of node objects is denoted
<code>Node</code>. The &quot;current node&quot; is stored in the global <code>focus</code>.</p>
<p><code>Node</code> methods:</p>
<ul>
<li><code>child(int) -&gt; Option&lt;Node&gt;</code>:
<a href="https://docs.rs/tree-sitter/latest/tree_sitter/struct.Node.html#method.child">Upstream docs</a></li>
<li><code>child_count() -&gt; int</code>:
<a href="https://docs.rs/tree-sitter/latest/tree_sitter/struct.Node.html#method.child_count">Upstream docs</a></li>
<li><code>kind() -&gt; String</code>:
<a href="https://docs.rs/tree-sitter/latest/tree_sitter/struct.Node.html#method.kind">Upstream docs</a></li>
<li><code>next_named_sibling() -&gt; Option&lt;Node&gt;</code>:
<a href="https://docs.rs/tree-sitter/latest/tree_sitter/struct.Node.html#method.next_named_sibling">Upstream docs</a></li>
<li><code>next_sibling() -&gt; Option&lt;Node&gt;</code>:
<a href="https://docs.rs/tree-sitter/latest/tree_sitter/struct.Node.html#method.next_sibling">Upstream docs</a></li>
<li><code>prev_named_sibling() -&gt; Option&lt;Node&gt;</code>:
<a href="https://docs.rs/tree-sitter/latest/tree_sitter/struct.Node.html#method.prev_named_sibling">Upstream docs</a></li>
<li><code>prev_sibling() -&gt; Option&lt;Node&gt;</code>:
<a href="https://docs.rs/tree-sitter/latest/tree_sitter/struct.Node.html#method.prev_sibling">Upstream docs</a></li>
<li><code>parent() -&gt; Option&lt;Node&gt;</code>:
<a href="https://docs.rs/tree-sitter/latest/tree_sitter/struct.Node.html#method.parent">Upstream docs</a></li>
<li><code>text() -&gt; String</code>: Return the text of the node</li>
</ul>
<h2 id="node-kinds"><a class="header" href="#node-kinds">Node kinds</a></h2>
<p>Each node in a tree-sitter parse tree has a <em>kind</em>, e.g., &quot;binary expression&quot;
or &quot;compound statement&quot;. Some of these kinds are <em>children</em> of each other,
e.g., &quot;call expression&quot; might be a child of &quot;expression&quot;. The following
functions can query such relationships:</p>
<ul>
<li><code>is_child_of(String, String) -&gt; bool</code>, (A)</li>
<li><code>is_descendant_of(String, String) -&gt; bool</code>, (A): Recursive, reflexive version
of <code>is_child_of</code></li>
<li><code>is_parent_of(String, String) -&gt; bool</code>, (A)</li>
<li><code>is_ancestor_of(String, String) -&gt; bool</code>, (A): Recursive, reflexive version
of <code>is_parent_of</code></li>
</ul>
<p>See <code>grammar.js</code> and <code>node_types.json</code> for the grammar in question for a list
of possible node kinds (or just use the pattern <code>${{print(focus:kind())}}</code>).</p>
<h2 id="state-and-evaluation-order"><a class="header" href="#state-and-evaluation-order">State and evaluation order</a></h2>
<p>When matching against a single node, Lua snippets in a pattern share the same
global state. Therefore, they can interact via global variables. For example,
the following pattern is functionally equivalent to
<code>let $_ = $_;</code>:</p>
<pre><code>let ${{foo = &quot;bar&quot;; return true}} = ${{foo == &quot;bar&quot;}};
</code></pre>
<p>Evaluation order is depth-first, left-to-right. But be careful! It's hard to
tell when and how many times a given snippet will execute.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="developers-guide"><a class="header" href="#developers-guide">Developer's guide</a></h1>
<h2 id="build"><a class="header" href="#build">Build</a></h2>
<p>To install from source, you'll need to install Rust and <a href="https://doc.rust-lang.org/cargo/">Cargo</a>. Follow
the instructions on the <a href="https://www.rust-lang.org/tools/install">Rust installation page</a>. Then, get
the source:</p>
<pre><code class="language-bash">git clone https://github.com/langston-barrett/mogglo
cd mogglo
</code></pre>
<p>Finally, build everything:</p>
<pre><code class="language-bash">cargo build --release
</code></pre>
<p>You can find binaries in <code>target/release</code>. Run tests with <code>cargo test</code>.</p>
<h2 id="docs"><a class="header" href="#docs">Docs</a></h2>
<p>HTML documentation can be built with <a href="https://rust-lang.github.io/mdBook/">mdBook</a>:</p>
<pre><code class="language-sh">cd doc
mdbook build
</code></pre>
<h2 id="release"><a class="header" href="#release">Release</a></h2>
<ul>
<li>
<p>Create branch with a name starting with <code>release</code></p>
</li>
<li>
<p>Update <code>CHANGELOG.md</code></p>
</li>
<li>
<p>Update the version numbers in <code>./crates/**/Cargo.toml</code></p>
<pre><code class="language-sh">find crates/ -type f -name &quot;*.toml&quot; -0 | \
  xargs -0 sed -E -i 's/^version = &quot;U.V.W&quot;$/version = &quot;X.Y.Z&quot;/'
</code></pre>
</li>
<li>
<p>Run <code>cargo build --release</code></p>
</li>
<li>
<p>Commit all changes and push the release branch</p>
</li>
<li>
<p>Check that CI was successful on the release branch</p>
</li>
<li>
<p>Merge the release branch to <code>main</code></p>
</li>
<li>
<p><code>git checkout main &amp;&amp; git pull origin &amp;&amp; git tag -a vX.Y.Z -m vX.Y.Z &amp;&amp; git push --tags</code></p>
</li>
<li>
<p>Verify that the release artifacts work as intended</p>
</li>
<li>
<p>Release the pre-release created by CI</p>
</li>
<li>
<p>Check that the crates were properly uploaded to crates.io</p>
</li>
</ul>
<h2 id="test"><a class="header" href="#test">Test</a></h2>
<p>Run end-to-end tests with <a href="https://www.llvm.org/docs/CommandGuide/lit.html"><code>lit</code></a> and <a href="https://www.llvm.org/docs/CommandGuide/FileCheck.html"><code>FileCheck</code></a>:</p>
<pre><code class="language-sh">cargo build
lit --path=$PWD/test/bin --path=$PWD/target/debug test/
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
